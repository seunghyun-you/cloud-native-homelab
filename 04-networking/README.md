# 04. Networking

외부 접근 및 내부 트래픽 라우팅을 위한 네트워크 서비스를 구성합니다.

## 개요

OCI(Oracle Cloud Infrastructure)를 활용한 외부 접근 게이트웨이와 홈랩 내부 네트워크 서비스를 구성합니다.

## 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              External User                                       │
│                                    │                                             │
│                                    │ HTTPS (*.container-wave.com)                │
│                                    ▼                                             │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │                         OCI VM (Free Tier)                               │    │
│  │                                                                          │    │
│  │   ┌────────────────────────────────────────────────────────────────┐    │    │
│  │   │                    Nginx Reverse Proxy                          │    │    │
│  │   │                                                                 │    │    │
│  │   │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │    │    │
│  │   │   │ :443        │  │ :8080       │  │ :8081       │            │    │    │
│  │   │   │ vscode.*    │  │ cicd.*      │  │ cicd.*      │            │    │    │
│  │   │   │ www.*       │  │ (Jenkins)   │  │ (Nexus)     │            │    │    │
│  │   │   │ cicd.*      │  │             │  │             │            │    │    │
│  │   │   │ mgmt.*      │  │             │  │             │            │    │    │
│  │   │   └──────┬──────┘  └──────┬──────┘  └──────┬──────┘            │    │    │
│  │   │          │                │                │                    │    │    │
│  │   │          └────────────────┼────────────────┘                    │    │    │
│  │   │                           │ SSL Termination                     │    │    │
│  │   │                           │ (Let's Encrypt)                     │    │    │
│  │   └───────────────────────────┼─────────────────────────────────────┘    │    │
│  │                               │                                          │    │
│  │   ┌───────────────────────────┼─────────────────────────────────────┐    │    │
│  │   │              OpenVPN Server (UDP 1194)                          │    │    │
│  │   │                           │                                     │    │    │
│  │   │              VPN Subnet: 192.168.200.0/24                       │    │    │
│  │   │              Server IP:  192.168.200.1                          │    │    │
│  │   └───────────────────────────┼─────────────────────────────────────┘    │    │
│  │                               │                                          │    │
│  └───────────────────────────────┼──────────────────────────────────────────┘    │
│                                  │ VPN Tunnel                                    │
│                                  │                                               │
└──────────────────────────────────┼───────────────────────────────────────────────┘
                                   │
┌──────────────────────────────────┼───────────────────────────────────────────────┐
│                                  │                                               │
│   Home Network                   │                                               │
│                                  ▼                                               │
│   ┌───────────────────────────────────────────────────────────────────────┐     │
│   │                    Mini PC (OpenVPN Client)                            │     │
│   │                    VPN IP: 192.168.200.2                               │     │
│   │                                                                        │     │
│   │   ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │     │
│   │   │ code-    │ │  ArgoCD  │ │ Jenkins  │ │  Nexus   │ │ Grafana  │   │     │
│   │   │ server   │ │  :8443   │ │  :18080  │ │  :18081  │ │  :80     │   │     │
│   │   │  :8080   │ │          │ │          │ │          │ │          │   │     │
│   │   └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘   │     │
│   │                                                                        │     │
│   └────────────────────────────────────────────────────────────────────────┘     │
│                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────┘
```

## 서비스 라우팅

| 외부 URL | 내부 주소 | 서비스 |
|----------|-----------|--------|
| `https://vscode.container-wave.com` | 192.168.200.2:8080 | Code Server (Web IDE) |
| `https://www.container-wave.com` | 192.168.200.2:9000 | Sample Application |
| `https://cicd.container-wave.com` | 192.168.200.2:8443 | ArgoCD |
| `https://cicd.container-wave.com:8080` | 192.168.200.2:18080 | Jenkins |
| `https://cicd.container-wave.com:8081` | 192.168.200.2:18081 | Nexus |
| `https://mgmt.container-wave.com` | 192.168.200.2:80 | Grafana |

## 구성 요소

### [Nginx Reverse Proxy](./nginx/)
- SSL/TLS Termination (Let's Encrypt)
- 서브도메인/포트 기반 라우팅
- WebSocket 지원 (Upgrade 헤더)

### [OpenVPN](./openvpn/)
- OCI ↔ 홈랩 간 암호화 터널
- UDP 1194 포트
- 192.168.200.0/24 VPN 서브넷

## 사용된 기술

| 기술 | 용도 | 버전 |
|------|------|------|
| Nginx | Reverse Proxy | 1.18+ |
| Let's Encrypt | SSL/TLS 인증서 | - |
| Certbot | 인증서 자동 갱신 | - |
| OpenVPN | VPN 터널링 | 2.6 |

## 관련 블로그 포스트

- [Nginx Reverse Proxy 설정](https://engineer-diarybook.tistory.com/entry/Nginx-Reverse-Proxy-%EC%84%A4%EC%A0%95-1)
- [Let's Encrypt 무료 인증서 생성 및 HTTPS 적용](https://engineer-diarybook.tistory.com/entry/Nginx-Lets-Encryption-%EB%AC%B4%EB%A3%8C-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EC%83%9D%EC%84%B1-%EB%B0%8F-HTTPS-%EC%A0%81%EC%9A%A9)
- [Private Container Image Registry (Nexus) 구축](https://engineer-diarybook.tistory.com/entry/Docker-Container-Image-Registry-%EA%B5%AC%EC%B6%95-Nexus)
